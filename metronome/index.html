<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8"/>
    <title>Metronome</title>
    <script src="vue.min.js"></script>
    <script src="metronome.js"></script>
    <link rel="stylesheet" href="metronome.css" />
</head>
<body>
    <div id="app">
        <div class="state">
            <input type="button" v-bind:value="active_label" v-on:click="update_active" />
        </div>
        <div class="instrument">
            <p>
                <span class="dial">{{ bpm }}</span>
                <span class="unit">beats per minute</span>
            </p>
            <input type="button" value="-" v-on:click="lower_tempo" />
            <input type="button" value="+" v-on:click="raise_tempo" />
        </div>
        <div class="instrument">
            <p>
                <span class="dial">{{ measure }}</span>
                <span class="unit">beats per measure</span>
            </p>
            <input type="button" value="-" v-on:click="lower_metre" />
            <input type="button" value="+" v-on:click="raise_metre" />
        </div>
    </div>

    <p>Credits:</p>
    <ul>
        <li><a href="https://www.fesliyanstudios.com/sound-effects-search.php">Free sound effects courtesy of Fesliyan Studios</a></li>
    </ul>

    <script>
        var metronome;
        var app;
        function init(bufStrong, bufWeak) {
            metronome = new Metronome(120, 4, 0.025, 0.100, bufStrong, bufWeak, audioContext);
            app = new Vue({
                el: '#app',
                data: {
                    active: metronome.active,
                    active_label: 'Start',
                    bpm: metronome.beatsPerMinute,
                    measure: metronome.beatsPerBar,
                },
                methods: {
                    update_active: function () {
                        this.active = !this.active;
                        this.active_label = this.active ? 'Stop' : 'Start';
                        metronome.active = this.active;
                    },
                    raise_tempo: function () {
                        if (this.bpm < 320) {
                            this.bpm += 5;
                            metronome.beatsPerMinute = this.bpm;
                        }
                    },
                    lower_tempo: function () {
                        if (this.bpm > 30) {
                            this.bpm -= 5;
                            metronome.beatsPerMinute = this.bpm;
                        }
                    },
                    raise_metre: function () {
                        if (this.measure < 12) {
                            this.measure += 1;
                            metronome.beatsPerBar = this.measure;
                        }
                    },
                    lower_metre: function () {
                        if (this.measure > 1) {
                            this.measure -= 1;
                            metronome.beatsPerBar = this.measure;
                        }
                    },
                },
            });
        }

        Promise.all([
            fetchAudioBuffer(new Request("c.mp3")),
            fetchAudioBuffer(new Request("c.distant.mp3")),
        ])
            .then(buffers => {
                init(buffers[0], buffers[1]);
            });
    </script>
</body>
</html>
